<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETH Analysis System Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #121212; color: #e0e0e0; }
        .container { max-width: 1400px; margin: auto; padding: 20px; }
        header { background-color: #1e1e1e; padding: 20px 0; text-align: center; border-bottom: 3px solid #007acc; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        header h1 { margin: 0; color: #007acc; font-size: 2em; text-transform: uppercase; letter-spacing: 2px;}
        .timer-container { text-align: center; margin-bottom: 25px; }
        .timer { font-size: 2em; color: #64b5f6; background-color: #2a2a2a; padding: 10px 20px; border-radius: 8px; display: inline-block; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .module { background-color: #252526; border: 1px solid #333; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .module h3 { margin-top: 0; color: #569cd6; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .module p { margin: 10px 0; line-height: 1.6; }
        .status { font-weight: bold; padding: 3px 8px; border-radius: 4px; color: #fff; }
        .status.ok { background-color: #4caf50; }
        .status.error { background-color: #f44336; }
        .status.running { background-color: #ff9800; }
        .status.pending { background-color: #78909c; }
        .log-output { background-color: #1e1e1e; color: #ccc; padding: 15px; border-radius: 4px; font-family: 'Consolas', 'Courier New', monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; border: 1px solid #333; margin-top:10px; }
        textarea { width: calc(100% - 22px); min-height: 60px; margin-top: 8px; background-color: #333; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; padding: 10px; }
        .notes-label { display: block; margin-top: 10px; font-weight: bold; color: #888; }
        .progress-bar-container { width: 100%; background-color: #444; border-radius: 4px; margin-top: 5px; }
        .progress-bar { width: 0%; height: 10px; background-color: #007acc; border-radius: 4px; text-align: center; line-height: 10px; color: white; font-size: 0.7em;}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ETH Analysis System Dashboard</h1>
        </header>
        <div class="timer-container">
            <div class="timer" id="liveTimer">00:00:00</div>
        </div>

        <div class="grid-container">
            <div class="module">
                <h3>Overall System</h3>
                <p>Status: <span id="systemStatus" class="status pending">Idle</span></p>
                <p>Last Run: <span id="lastRunTime">-</span></p>
                <p>Current Stage: <span id="currentStage">-</span> (<span id="currentStageTimer">0s</span>)</p>
                <div class="notes-label">System Notes:</div>
                <textarea id="systemNotes" placeholder="General notes about the system run..."></textarea>
            </div>

            <div class="module">
                <h3>Data Collection</h3>
                <p>Technical Data (ETH): <span id="techDataEthStatus" class="status pending">Pending</span> <span id="techDataEthTime"></span></p>
                <div class="progress-bar-container"><div id="techDataEthProgress" class="progress-bar"></div></div>
                <p>Technical Data (BTC): <span id="techDataBtcStatus" class="status pending">Pending</span> <span id="techDataBtcTime"></span></p>
                <div class="progress-bar-container"><div id="techDataBtcProgress" class="progress-bar"></div></div>
                <p>Telegram News: <span id="newsDataStatus" class="status pending">Pending</span> <span id="newsDataTime"></span></p>
                <div class="progress-bar-container"><div id="newsDataProgress" class="progress-bar"></div></div>
                <div class="notes-label">Data Collection Notes:</div>
                <textarea id="dataCollectionNotes" placeholder="Notes for data collection..."></textarea>
            </div>

            <div class="module">
                <h3>Analysis & Signal Generation</h3>
                <p>Technical Analysis: <span id="taStatus" class="status pending">Pending</span> <span id="taTime"></span></p>
                <p>News Sentiment Analysis: <span id="newsSentimentStatus" class="status pending">Pending</span> <span id="newsSentimentTime"></span></p>
                <p>Signal Generation: <span id="signalGenerationStatus" class="status pending">Pending</span> <span id="signalGenTime"></span></p>
                <p>Current Signal: <strong id="currentSignal">-</strong> (<span id="signalConfidence">-%</span> confidence)</p>
                <div class="notes-label">Analysis Notes:</div>
                <textarea id="analysisNotes" placeholder="Notes for analysis..."></textarea>
            </div>
            
            <div class="module">
                <h3>Model Training (Random Forest)</h3>
                <p>Status: <span id="rfStatus" class="status pending">Idle</span> <span id="rfTrainingTime"></span></p>
                <div class="progress-bar-container"><div id="rfTrainingProgress" class="progress-bar"></div></div>
                <p>Last Accuracy (Test): <span id="rfAccuracy">-</span></p>
                <p>Best Params: <span id="rfParams">-</span></p>
                <div class="notes-label">RF Training Notes:</div>
                <textarea id="rfTrainingNotes" placeholder="Notes for Random Forest training..."></textarea>
            </div>

             <div class="module">
                <h3>Model Training (GRU Neural Network)</h3>
                <p>Status: <span id="gruStatus" class="status pending">Idle</span> <span id="gruTrainingTime"></span></p>
                <div class="progress-bar-container"><div id="gruTrainingProgress" class="progress-bar"></div></div>
                <p>Last MAE (Test): <span id="gruMae">-</span></p>
                <p>Epochs: <span id="gruEpochs">-</span></p>
                <div class="notes-label">GRU Training Notes:</div>
                <textarea id="gruTrainingNotes" placeholder="Notes for GRU training..."></textarea>
            </div>
        </div>

        <div class="module" style="grid-column: 1 / -1;"> <!-- Spans full width -->
            <h3>Live Log Output</h3>
            <div id="logOutput" class="log-output">Waiting for logs...</div>
        </div>
    </div>

    <script>
        let sessionStartTime = Date.now();
        function updateLiveTimer() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const h = String(Math.floor(elapsed / 3600)).padStart(2, '0');
            const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
            const s = String(elapsed % 60).padStart(2, '0');
            document.getElementById('liveTimer').textContent = `${h}:${m}:${s}`;
        }
        setInterval(updateLiveTimer, 1000);

        // --- WebSocket/SSE Placeholder ---
        // This is where you would connect to your Python backend to get real-time updates.
        // For example:
        // const eventSource = new EventSource('/stream_status'); // If using SSE with FastAPI/Flask
        // eventSource.onmessage = function(event) {
        //     const data = JSON.parse(event.data);
        //     updateDashboard(data);
        // };

        function updateDashboard(data) {
            // Update overall status
            setText('systemStatus', data.overall_status?.status || 'Idle', data.overall_status?.status_class);
            setText('lastRunTime', data.overall_status?.last_run_timestamp || '-');
            setText('currentStage', data.current_stage?.name || '-', data.current_stage?.status_class);
            setText('currentStageTimer', data.current_stage?.elapsed_time ? `${data.current_stage.elapsed_time.toFixed(1)}s` : '0s');

            // Update Data Collection
            updateModuleStatus('techDataEth', data.data_collection?.eth_technical);
            updateModuleStatus('techDataBtc', data.data_collection?.btc_technical);
            updateModuleStatus('newsData', data.data_collection?.telegram_news);
            
            // Update Analysis
            updateModuleStatus('ta', data.analysis?.technical_analysis);
            updateModuleStatus('newsSentiment', data.analysis?.news_sentiment);
            updateModuleStatus('signalGeneration', data.analysis?.signal_generation);
            setText('currentSignal', data.analysis?.current_signal?.signal || '-');
            setText('signalConfidence', data.analysis?.current_signal?.confidence ? `${(data.analysis.current_signal.confidence * 100).toFixed(1)}%` : '-%');

            // Update RF Training
            updateModuleStatus('rfStatus', data.rf_training?.status_text, data.rf_training?.status_class);
            setProgressBar('rfTrainingProgress', data.rf_training?.progress);
            setText('rfTrainingTime', data.rf_training?.elapsed_time ? `${data.rf_training.elapsed_time.toFixed(1)}s` : '');
            setText('rfAccuracy', data.rf_training?.test_accuracy ? data.rf_training.test_accuracy.toFixed(4) : '-');
            setText('rfParams', data.rf_training?.best_params ? JSON.stringify(data.rf_training.best_params) : '-');
            
            // Update GRU Training
            updateModuleStatus('gruStatus', data.gru_training?.status_text, data.gru_training?.status_class);
            setProgressBar('gruTrainingProgress', data.gru_training?.progress);
            setText('gruTrainingTime', data.gru_training?.elapsed_time ? `${data.gru_training.elapsed_time.toFixed(1)}s` : '');
            setText('gruMae', data.gru_training?.test_mae ? data.gru_training.test_mae.toFixed(4) : '-');
            setText('gruEpochs', data.gru_training?.current_epoch ? `${data.gru_training.current_epoch}/${data.gru_training.total_epochs}` : '-');

            // Update Log Output
            if (data.log_message) {
                const logOutput = document.getElementById('logOutput');
                const newLogEntry = document.createElement('div');
                newLogEntry.textContent = `[${new Date().toLocaleTimeString()}] ${data.log_message}`;
                logOutput.appendChild(newLogEntry);
                logOutput.scrollTop = logOutput.scrollHeight; 
            }
        }

        function setText(elementId, text, statusClass = null) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
                if (statusClass) {
                    element.className = `status ${statusClass}`;
                }
            }
        }
        
        function updateModuleStatus(baseId, moduleData) {
            if (!moduleData) return;
            setText(`${baseId}Status`, moduleData.status || 'Pending', moduleData.status_class);
            setText(`${baseId}Time`, moduleData.elapsed_time ? `(${moduleData.elapsed_time.toFixed(1)}s)` : '');
            setProgressBar(`${baseId}Progress`, moduleData.progress);
        }

        function setProgressBar(elementId, progressPercent) {
            const element = document.getElementById(elementId);
            if (element && progressPercent !== undefined) {
                element.style.width = `${Math.max(0, Math.min(100, progressPercent))}%`;
            }
        }

        // Example of how you might manually trigger an update for testing UI
        // setTimeout(() => {
        //     updateDashboard({
        //         overall_status: { status: "Running", status_class: "running", last_run_timestamp: new Date().toLocaleString()},
        //         current_stage: { name: "Technical Analysis", elapsed_time: 15.2, status_class: "running" },
        //         data_collection: { 
        //             eth_technical: { status: "OK", status_class: "ok", elapsed_time: 5.1, progress: 100},
        //             btc_technical: { status: "Running", status_class: "running", elapsed_time: 2.3, progress: 50},
        //             telegram_news: { status: "Pending", status_class: "pending"}
        //         },
        //         log_message: "Example log message: Process started."
        //     });
        // }, 2000);
    </script>
</body>
</html>
